[33mcommit 944ff14aae15932afd369c20ed7d96855de090c6[m
Author: Ubuntu <ubuntu@hestia>
Date:   Mon Jan 12 16:06:35 2026 +0000

    fix: security improvements and automated backups
    
    Security fixes:
    - Replace Math.random() with crypto.randomInt() for secure token generation
    - Add rate limiting to password reset endpoint
    - Fix syncSocials authorization to use authenticated user instead of first user
    - Add account lockout after 5 failed login attempts (15 min lockout)
    - Add unique constraint on Referral (referrerId, refereeId) to prevent duplicates
    - Add failedLoginAttempts and lockedUntil fields to User model
    - Bind PostgreSQL port to localhost only (127.0.0.1:5432)
    - Remove weak default passwords from docker-compose (require env vars)
    
    Infrastructure improvements:
    - Add automated backup service running every 6 hours
    - Implement smart retention policy (24 hourly, 7 daily, 4 weekly, 12 monthly)
    - Compress backups with gzip to save space
    - Add /backup volume mount for persistent backups
    - Update backup/restore scripts to work with new location and format
    - Add .env.example to document required environment variables
    
    Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>

[1mdiff --git a/.env.example b/.env.example[m
[1mnew file mode 100644[m
[1mindex 0000000..5880282[m
[1m--- /dev/null[m
[1m+++ b/.env.example[m
[36m@@ -0,0 +1,48 @@[m
[32m+[m[32m# ============================================[m
[32m+[m[32m# Cofactor Club - Environment Configuration[m
[32m+[m[32m# ============================================[m
[32m+[m[32m# Copy this file to .env and fill in your values[m
[32m+[m[32m# All marked REQUIRED must be set for production[m
[32m+[m
[32m+[m[32m# --------------------------------------------[m
[32m+[m[32m# Database Configuration[m
[32m+[m[32m# --------------------------------------------[m
[32m+[m[32mPOSTGRES_USER=cofactor[m
[32m+[m[32mPOSTGRES_PASSWORD=your_secure_db_password_here  # REQUIRED - Change this![m
[32m+[m[32mPOSTGRES_DB=cofactor_db[m
[32m+[m
[32m+[m[32m# --------------------------------------------[m
[32m+[m[32m# Application Configuration[m
[32m+[m[32m# --------------------------------------------[m
[32m+[m[32m# Generate with: openssl rand -base64 32[m
[32m+[m[32mNEXTAUTH_SECRET=your_nextauth_secret_here  # REQUIRED - Change this![m
[32m+[m[32mNEXTAUTH_URL=https://your-domain.com[m
[32m+[m
[32m+[m[32m# --------------------------------------------[m
[32m+[m[32m# Admin Account Seeding[m
[32m+[m[32m# --------------------------------------------[m
[32m+[m[32mADMIN_EMAIL=admin@yourdomain.com  # REQUIRED[m
[32m+[m[32mADMIN_PASSWORD=your_admin_password_here  # REQUIRED - Use a strong password[m
[32m+[m
[32m+[m[32m# --------------------------------------------[m
[32m+[m[32m# Staff Registration[m
[32m+[m[32m# --------------------------------------------[m
[32m+[m[32m# Secret code for staff signup (optional)[m
[32m+[m[32mSTAFF_SECRET_CODE=STAFF_2026[m
[32m+[m
[32m+[m[32m# --------------------------------------------[m
[32m+[m[32m# SMTP Email Configuration[m
[32m+[m[32m# --------------------------------------------[m
[32m+[m[32m# Leave SMTP_USER empty to skip email configuration[m
[32m+[m[32mSMTP_HOST=smtp.gmail.com[m
[32m+[m[32mSMTP_PORT=587[m
[32m+[m[32mSMTP_USER=your-email@gmail.com[m
[32m+[m[32mSMTP_PASS=your-app-password-here[m
[32m+[m[32mSMTP_FROM="Cofactor Club" <no-reply@yourdomain.com>[m
[32m+[m
[32m+[m[32m# --------------------------------------------[m
[32m+[m[32m# Cloudflare Tunnel (Production)[m
[32m+[m[32m# --------------------------------------------[m
[32m+[m[32m# Get your token from: https://dash.cloudflare.com/[m
[32m+[m[32m# Leave empty to disable tunnel[m
[32m+[m[32mCLOUDFLARE_TOKEN=[m
